<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MyTube Shorts ‚Äî Center Column</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    html,body{height:100%;margin:0;background:white;display:flex;justify-content:center;}
    /* container centered column */
    #shortsContainer {
  height: 100vh;
  width: 100%;
  max-width: 420px;
  overflow-y: scroll;
  scroll-snap-type: y mandatory;
  -webkit-overflow-scrolling: touch;
  background: #000;

  /* Hide scrollbar */
  scrollbar-width: none;  
  -ms-overflow-style: none; 
}
#shortsContainer::-webkit-scrollbar {
  display: none;
}
    #shortsContainer{
      height:100vh;
      width:100%;
      max-width:420px;
      overflow-y:scroll;
      scroll-snap-type:y mandatory;
      -webkit-overflow-scrolling:touch;
      background:black;
    }

    .short-card{
      position:relative;
      height:100vh;
      scroll-snap-align:start;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:12px;
      box-sizing:border-box;
    }

    /* video looks like phone vertical */
    .short-video{
      width:100%;
      height:100%;
      object-fit:cover;
      border-radius:12px;
      background:#111;
    }

    .short-info{
      position:absolute;
      left:16px;
      right:16px;
      bottom:70px;
      color:#fff;
      text-shadow:0 2px 6px rgba(0,0,0,0.6);
      pointer-events:none;
    }
    .short-info h6{margin:0;font-size:18px}
    .short-info small{color:#ddd;font-size:13px}

    .short-actions{
      position:absolute;
      right:12px;
      bottom:130px;
      display:flex;
      flex-direction:column;
      gap:14px;
      align-items:center;
      pointer-events:auto;
    }
    .short-actions button{
      background:rgba(0,0,0,0.45);
      border:none;
      color:#fff;
      width:44px;
      height:44px;
      border-radius:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:18px;
      cursor:pointer;
    }
    .short-actions button:active{transform:scale(0.98)}

    .mute-btn{
      position:absolute;
      left:12px;
      bottom:130px;
      background:rgba(0,0,0,0.45);
      color:#fff;
      border:none;
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
      font-size:14px;
      pointer-events:auto;
    }

    /* small helper when video is muted */
    .hint {
      position:absolute;
      left:16px;
      bottom:40px;
      color:#fff;
      font-size:13px;
      opacity:0.9;
      text-shadow:0 1px 3px rgba(0,0,0,0.6);
    }

    /* responsive tweaks */
    @media (min-width:900px){
      #shortsContainer{box-shadow:0 6px 24px rgba(0,0,0,0.6)}
    }
    body { overflow-x: hidden; }

  .navbar {
    height: 56px;
    background-color: #fff;
    border-bottom: 1px solid #ddd;
    z-index: 1030;
  }

  /* Sidebar */
  .sidebar {
    position: fixed;
    top: 56px;
    bottom: 0;
    left: 0;
    width: 240px;
    background-color: #fff;
    border-right: 1px solid #ddd;
    overflow-y: auto;
    transition: transform 0.3s ease;
    z-index: 1029;
  }
  .sidebar a {
    display: block;
    padding: 10px 20px;
    color: #000;
    text-decoration: none;
  }
  .sidebar a:hover {
    background: #f0f0f0;
  }

  /* Content area */
  .content {
    margin-top: 56px;
    margin-left: 240px;
    padding: 20px;
    transition: margin-left 0.3s ease;
  }

  /* Collapsed sidebar */
  .sidebar.collapsed {
    transform: translateX(-240px);
  }
  .content.expanded {
    margin-left: 0;
  }

  /* Video cards */
  .video-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
  }

  /* 3-column layout on lg screens */
  @media (min-width: 992px) {
    .video-col { width: 33.333%; }
  }

  /* Responsive collapse on <992px */
  @media (max-width: 991px) {
    .sidebar { transform: translateX(-240px); }
    .content { margin-left: 0; }
  }
  .video-card img {
  object-fit: cover;
  height: 180px;
}
.playlist-title {
  font-size: 18px;
  font-weight: 600;
  margin-top: 30px;
  margin-bottom: 15px;
}

.video-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 15px;
}
.video-card img {
  object-fit: cover;
  height: 180px;
}
/* Base Dark Mode */
body.dark-mode {
  background-color: #121212;
  color: #e0e0e0;
}

/* Navbar */
body.dark-mode .navbar,
body.dark-mode nav {
  background-color: #1f1f1f !important;
  color: #e0e0e0;
}

body.dark-mode .navbar a,
body.dark-mode nav a {
  color: #e0e0e0 !important;
}

/* Sidebar */
body.dark-mode #sidebar {
  background-color: #1e1e1e !important;
  color: #e0e0e0;
}

body.dark-mode #sidebar a {
  color: #e0e0e0 !important;
}

/* Cards */
body.dark-mode .card {
  background-color: #1e1e1e;
  border-color: #333;
}

/* Video titles and texts */
body.dark-mode .card-title,
body.dark-mode .card-text,
body.dark-mode h1,
body.dark-mode h2,
body.dark-mode h3,
body.dark-mode h4,
body.dark-mode h5,
body.dark-mode h6 {
  color: #e0e0e0;
}

/* Buttons */
body.dark-mode .btn {
  background-color: #333;
  color: #e0e0e0;
  border-color: #444;
}

/* Toggle Button itself */
#themeToggle {
  margin: 0 10px;
  cursor: pointer;
}

/* Smooth transitions */
body, .card, .navbar, #sidebar {
  transition: background-color 0.3s, color 0.3s;
}

.notification-item {
  border-bottom: 1px solid #ddd;
  padding: 0.5rem 0;
}
body.dark-mode .notification-item {
  border-color: #333;
}

  </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg fixed-top">
  <div class="container-fluid">
    <!-- Hamburger -->
    <button id="toggleSidebar" class="btn btn-link text-dark me-2" type="button">
      <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>

    <a class="navbar-brand d-flex align-items-center" href="#">
      <div style="width:30px;height:20px;background:#ff0000;display:inline-flex;align-items:center;justify-content:center;margin-right:6px;">
        <svg viewBox="0 0 24 24" width="14" height="14" fill="white">
          <path d="M10 8.5v7l6-3.5-6-3.5z"></path>
        </svg>
      </div>
      MyTube
    </a>

    <!-- Search -->
    <form class="d-none d-lg-flex mx-auto w-50">
      <input class="form-control rounded-start-pill" type="search" placeholder="Search">
      <button class="btn btn-outline-secondary rounded-end-pill" type="submit">üîç</button>
    </form>

    <!-- Right buttons -->
    <div class="d-flex align-items-center">
      <button id="themeToggle" class="btn btn-sm btn-secondary">üåô</button>
      <button class="btn btn-outline-secondary position-relative" type="button" data-bs-toggle="offcanvas" data-bs-target="#notificationCanvas" aria-controls="notificationCanvas">
      üîî
      <span id="notificationBadge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
        0
      </span>
    </button>
      <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center" style="width:32px;height:32px;font-size:14px;font-weight:bold;">JD</div>
    </div>
  </div>
</nav>
<!-- Right-side Offcanvas -->

<!-- Sidebar -->
<div id="sidebar" class="sidebar">
  <a href="./index.html">üè† Home</a>
  <a href="short.html">üé¨ Shorts</a>
  <hr>
  <a href="./history.html">üïò History</a>
  <a href="./playlist.html">üìú Playlists</a>
  <a href="./watchlater.html">‚è± Watch Later</a>
 
</div>

<!-- Main content with video cards -->

<div id="shortsContainer" aria-label="Shorts feed"></div>
  
  <div class="offcanvas offcanvas-end" tabindex="-1" id="notificationCanvas" aria-labelledby="notificationCanvasLabel">
    <div class="offcanvas-header">
      <h5 id="notificationCanvasLabel">Notifications</h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <div id="notificationsList">
        <p class="text-muted">No notifications.</p>
      </div>
    </div>
            </div>


  <script>
  (async function(){
    // load data
    let data;
    try {
      const res = await fetch('shorts.json');
      data = await res.json();
    } catch (err) {
      document.getElementById('shortsContainer').innerHTML = '<p style="color:#fff;padding:20px">Error loading shorts.json ‚Äî make sure the file is served (not opened via file://).</p>';
      console.error(err);
      return;
    }
    const shorts = data.shorts || [];
    const container = document.getElementById('shortsContainer');

    // build DOM
    container.innerHTML = shorts.map(s => `
      <div class="short-card" data-id="${s.id}">
        <video class="short-video" playsinline webkit-playsinline muted loop preload="metadata" poster="${s.thumbnail}" data-src="${s.video}"></video>

        <div class="short-info">
          <h6>${escapeHtml(s.title)}</h6>
          <small>${escapeHtml(s.views)} views</small>
        </div>

        <div class="short-actions" aria-hidden="false">
          <button class="like-btn" title="Like">‚ù§Ô∏è</button>
          <button class="comment-btn" title="Comment">üí¨</button>
          <button class="share-btn" title="Share">üîó</button>
        </div>

        <button class="mute-btn" aria-label="Toggle sound">üîà</button>
        <div class="hint">Tap video to pause/play ¬∑ Tap speaker to unmute</div>
      </div>
    `).join('');

    // helpers
    function escapeHtml(str){ return String(str).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }

    const cards = Array.from(document.querySelectorAll('.short-card'));
    if(cards.length === 0) return;

    // IntersectionObserver thresholds
    function buildThresholdList() {
      const thresholds = [];
      for (let i = 0; i <= 100; i++) thresholds.push(i / 100);
      return thresholds;
    }

    let currentCard = null;

    const observer = new IntersectionObserver(entries=>{
      // update each entry's ratio on the element
      entries.forEach(e => e.target._ratio = e.intersectionRatio);
      // pick the element with highest ratio
      const best = cards.map(c => ({el:c,ratio:c._ratio || 0}))
                       .sort((a,b)=>b.ratio - a.ratio)[0];

      if (!best) return;
      if (best.ratio >= 0.60) {
        if (currentCard !== best.el) playCard(best.el);
      } else {
        // if nothing is sufficiently visible, pause current
        if (currentCard) {
          pauseCard(currentCard);
          currentCard = null;
        }
      }
    }, { root: container, threshold: buildThresholdList() });

    cards.forEach(c => observer.observe(c));

    // Play/pause logic with lazy load
    function playCard(card) {
      // pause previous
      if (currentCard && currentCard !== card) pauseCard(currentCard);

      const video = card.querySelector('video');
      if (!video) return;

      // lazy-load source
      if (!video.src) {
        video.src = video.dataset.src;
        // load triggered automatically by play(); but ensure metadata loaded for poster-> video
        video.load();
      }

      // ensure muted initially (autoplay muted allowed)
      video.muted = true;

      const promise = video.play();
      if (promise && promise.catch) {
        promise.catch(err => {
          // autoplay might be blocked; user can tap to play
          console.log('Autoplay prevented or failed (will wait for user interaction):', err);
        });
      }

      // update mute button icon
      const muteBtn = card.querySelector('.mute-btn');
      if (muteBtn) muteBtn.textContent = video.muted ? 'üîà' : 'üîä';

      currentCard = card;

      // preload neighbors (previous and next)
      const idx = cards.indexOf(card);
      [idx - 1, idx + 1].forEach(i => {
        if (cards[i]) {
          const v = cards[i].querySelector('video');
          if (v && !v.src) { v.src = v.dataset.src; v.load(); }
        }
      });
    }

    function pauseCard(card) {
      const video = card.querySelector('video');
      if (!video) return;
      try { video.pause(); } catch(e){/*ignore*/}
      // Optionally remove src to free memory/bandwidth:
      // video.removeAttribute('src'); video.load();
    }

    // initial play the first card
    playCard(cards[0]);

    // Click handlers:
    container.addEventListener('click', e => {
      const card = e.target.closest('.short-card');
      if (!card) return;
      const video = card.querySelector('video');
      if (!video) return;

      // mute/unmute button
      if (e.target.classList.contains('mute-btn')) {
        e.stopPropagation();
        video.muted = !video.muted;
        e.target.textContent = video.muted ? 'üîà' : 'üîä';
        return;
      }

      // action buttons can be handled here (like/share)
      if (e.target.classList.contains('like-btn')) { alert('Liked! (demo)'); return; }
      if (e.target.classList.contains('comment-btn')) { alert('Open comments (demo)'); return; }
      if (e.target.classList.contains('share-btn')) { alert('Share link (demo)'); return; }

      // default: toggle play/pause on video area tap
      if (video.paused) {
        const p = video.play();
        if (p && p.catch) p.catch(() => { /* user gesture needed */ });
      } else {
        video.pause();
      }
    });

    // space toggles current video play/pause
    window.addEventListener('keydown', e => {
      if (e.code === 'Space') {
        e.preventDefault();
        if (currentCard) {
          const v = currentCard.querySelector('video');
          if (v.paused) v.play(); else v.pause();
        }
      }
    });

    // optional: when user taps mute/unmute, resume autoplay for that video (most browsers allow)
    // Also show small hint that audio is muted
  })();
  </script>
  <script src="./theme.js"></script>
</body>
</html>
